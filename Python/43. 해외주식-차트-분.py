import asyncio
import ebest
from common import *
from app_keys import appkey, appsecretkey # app_keys.py 파일에 appkey, appsecretkey 변수를 정의하고 사용하세요

async def sample(api):
    keysymbol = "82TSLA" # 82TSLA: 테슬라, 82AAPL: 애플
    inputs = {
        'g3203InBlock': {
            "delaygb": "R",             # 지연구분 "R":실시간
            "keysymbol": keysymbol,     # KEY종목코드
            "exchcd": keysymbol[:2],    # 거래소코드(81: 뉴욕/아멕스, 82: 나스닥)
            "symbol": keysymbol[2:],    # 종목코드
            "ncnt": 10,                 # 단위(n분)
            "qrycnt": 100,              # 요청건수(최대-압축:2000비압축:500)
            "comp_yn": "N",             # 압축여부(Y:압축N:비압축)
            "sdate": "",                # 시작일자
            "edate": "",                # 종료일자
            "cts_date": "",             # 연속일자 (연속조회시 필요)
            "cts_time": "",             # 연속시간 (연속조회시 필요)
        },
    }
    response = await api.request('g3203', inputs)
    if not response: return print(f"요청 실패: {api.last_message}")
    
    print(response)
    

async def main():
    api=ebest.OpenApi()
    if not await api.login(appkey, appsecretkey):
        return print(f'연결실패: {api.last_message}')
    await sample(api)
    await api.close()

if __name__ == '__main__':
    asyncio.run(main())


# Output:
'''
tr_cont='Y', tr_cont_key='0'
g3203OutBlock
Field Count = 19
+-----------+----------+
|    key    |  value   |
+-----------+----------+
|  delaygb  |    R     |
| keysymbol |  82TSLA  |
|   exchcd  |    82    |
|   symbol  |   TSLA   |
|  cts_date | 20250508 |
|  cts_time |  052000  |
| rec_count |   100    |
|  preopen  | 279.6300 |
|  prehigh  | 289.8000 |
|   prelow  | 279.4100 |
|  preclose | 284.8200 |
| prevolume | 97539448 |
|    open   | 285.5000 |
|    high   | 286.8200 |
|    low    | 284.1000 |
|   close   | 286.2700 |
|   s_time  |  200000  |
|   e_time  |  180000  |
|  timediff |   -13    |
+-----------+----------+
g3203OutBlock1
Row Count = 100
+----------+---------+----------+----------+----------+----------+---------+--------+
|   date   | loctime |   open   |   high   |   low    |  close   |  exevol | amount |
+----------+---------+----------+----------+----------+----------+---------+--------+
| 20250508 |  053000 | 280.7500 | 281.6000 | 280.7400 | 281.0600 |  24536  |   0    |
| 20250508 |  054000 | 281.0900 | 281.1500 | 280.4400 | 280.8300 |  16173  |   0    |
| 20250508 |  055000 | 280.8700 | 281.1900 | 280.6000 | 280.7000 |  11414  |   0    |
| 20250508 |  060000 | 280.7400 | 280.9400 | 280.3300 | 280.3600 |  10168  |   0    |
| 20250508 |  061000 | 280.3900 | 280.9800 | 280.3000 | 280.8000 |   7086  |   0    |
...
| 20250508 |  211000 | 285.5800 | 285.6000 | 285.2700 | 285.5000 |  13380  |   0    |
| 20250508 |  212000 | 285.4900 | 285.9400 | 285.4200 | 285.9400 |   8865  |   0    |
| 20250508 |  213000 | 285.9500 | 286.6500 | 285.7800 | 286.0000 |  15968  |   0    |
| 20250508 |  214000 | 286.1500 | 286.2000 | 285.7000 | 285.7000 |   7199  |   0    |
| 20250508 |  215000 | 285.9200 | 286.4900 | 285.8800 | 286.3000 |   5748  |   0    |
| 20250508 |  220000 | 286.3000 | 286.7700 | 286.1500 | 286.7000 |  10541  |   0    |
| 20250508 |  221000 | 286.7000 | 286.8200 | 286.4000 | 286.4000 |   7894  |   0    |
| 20250508 |  222000 | 286.3900 | 286.7400 | 286.3400 | 286.6300 |   7689  |   0    |
| 20250508 |  223000 | 286.6000 | 286.7000 | 286.5000 | 286.6300 |   1724  |   0    |
| 20250508 |  224000 | 286.6300 | 286.6700 | 286.5600 | 286.6400 |   4182  |   0    |
| 20250508 |  225000 | 286.6500 | 286.7700 | 286.5000 | 286.5000 |   3615  |   0    |
| 20250508 |  230000 | 286.5000 | 286.6100 | 285.2800 | 285.2800 |  15932  |   0    |
| 20250508 |  231000 | 285.3200 | 285.9000 | 285.2600 | 285.9000 |   9182  |   0    |
| 20250508 |  232000 | 285.9000 | 286.1000 | 285.6800 | 285.7300 |   4024  |   0    |
| 20250508 |  233000 | 285.7500 | 285.8100 | 285.5100 | 285.5900 |   1843  |   0    |
| 20250508 |  234000 | 285.6500 | 285.7200 | 285.5900 | 285.7100 |   2910  |   0    |
| 20250508 |  235000 | 285.7000 | 286.2500 | 285.5500 | 286.1100 |   8108  |   0    |
| 20250508 |  240000 | 286.2000 | 286.3600 | 286.1500 | 286.2700 |   2973  |   0    |
+----------+---------+----------+----------+----------+----------+---------+--------+
rsp_cd
00000
rsp_msg
조회완료
'''
